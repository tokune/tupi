function handleFiles(a){var b=[],c=[],d=!0;for(var e=0,f=a.length;e<f;e++){if(!a[e].type.match(/image*/)||a[e].size/1024/1024>4){var g="";return a[e].type.match(/image*/)?g="文件大小超过4M":g="请上传图片",bigbox.log("注意").error(g),d=!1,!1}c[e]=a[e]}var h=[],i=[];for(var j=0,f=c.length;j<f;j++)h.push(new FileReader);for(var e=0;e<h.length;e++)h[e].readAsDataURL(c[e]),h[e].onload=function(a){var b=doc.createElement("div");b.className="loadbox";var e=doc.createElement("img");e.src=this.result,b.appendChild(e),previewbox.appendChild(b),i.push(b),d&&c.length==i.length&&ajax(0,c,i)}}function ajax(a,b,c){var d=new XMLHttpRequest,e=doc.createElement("p"),f=doc.createElement("div"),g=c[a],h=doc.createTextNode("上传进度：100%"),i=doc.createTextNode("上传进度：");f.className="notice",d.open("post","/",!0),d.upload.addEventListener("progress",function(a){e.innerHTML="完成："+Math.round(a.loaded*100/a.total)+"%",f.appendChild(e),g.appendChild(f)},!1),d.upload.addEventListener("load",function(d){return a++,a>=b.length?(jacked.log("上传完成"),!1):ajax(a,b,c)},!1),d.onreadystatechange=function(){if(d.readyState==4&&d.status==200){key=d.responseText;if(key=="error")bigbox.log("注意").error("所上传的文件有误");else{var a=doc.createElement("embed");a.setAttribute("height",20),a.setAttribute("width",64),a.setAttribute("flashvars","clipboard=http://"+doc.domain+"/"+d.responseText),a.setAttribute("quality","high"),a.setAttribute("bgcolor","#eeeeee"),a.setAttribute("ame","copy"),a.setAttribute("id","copy"),a.setAttribute("mediawrapchecked","true"),a.setAttribute("pluginspage","http://www.macromedia.com/go/getflashplayer"),a.setAttribute("src","/static/copy.swf"),a.setAttribute("type","application/x-shockwave-flash"),a.setAttribute("splayername","SWF"),a.setAttribute("tplayername","SWF"),f.appendChild(a),g.appendChild(f)}}};var j=new FormData;j.append("file"+a,b[a]),d.send(j)}var doc=document,dropbox=doc.getElementById("dropbox"),previewbox=doc.getElementById("previewbox"),bigbox=humane.create({baseCls:"humane-bigbox",timeout:1e3});bigbox.error=bigbox.spawn({addnCls:"humane-bigbox-error"});var jacked=humane.create({baseCls:"humane-jackedup",addnCls:"humane-jackedup-success"});dropbox.addEventListener("dragenter",function(a){dropbox.style.borderColor="gray",dropbox.style.backgroundColor="#cccccc",a.stopPropagation(),a.preventDefault()},!1),dropbox.addEventListener("dragleave",function(a){dropbox.style.backgroundColor="#f4f2e6"},!1),dropbox.addEventListener("dragover",function(a){a.stopPropagation(),a.preventDefault()},!1),dropbox.addEventListener("drop",function(a){a.stopPropagation(),a.preventDefault(),dropbox.style.backgroundColor="#f4f2e6",handler=handleFiles(a.dataTransfer.files)},!1);